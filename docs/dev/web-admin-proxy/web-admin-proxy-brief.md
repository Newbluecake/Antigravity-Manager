# Web Admin 代理配置页面复刻 - 需求简报

> **生成时间**: 2026-01-12
> **访谈轮次**: 第 3 轮
> **细节级别**: standard
> **版本**: v1.0 Final

## 1. 一句话描述

在 Web Admin 管理端完整复刻桌面应用的 API 代理配置页面，实现像素级 UI 一致性和功能完整性，使用户能够通过浏览器进行与桌面端完全相同的代理配置管理。

## 2. 目标用户

- 主要用户：通过浏览器访问 Web Admin 的管理员用户
- 次要用户：无法使用桌面应用的用户（如服务器部署场景）

## 3. 核心场景（Top 5）

### 场景 1: 代理服务控制
- **触发**: 用户访问 Web Admin 代理页面，点击启动/停止代理按钮
- **结果**: 代理服务状态切换，页面实时显示端口、URL、活跃账号数等信息

### 场景 2: 模型映射配置
- **触发**: 用户需要配置特定模型到 Claude/Gemini/OpenAI 的映射规则
- **结果**: 打开模型映射配置界面，支持添加、编辑、删除映射规则，配置回退链

### 场景 3: 粘性会话管理
- **触发**: 用户需要配置会话粘性以保证同一对话使用同一账号
- **结果**: 配置粘性会话开关、TTL、清理策略，查看活跃会话统计

### 场景 4: 高级参数调整
- **触发**: 用户需要调整超时时间、Token 管理、上游代理等高级设置
- **结果**: 展开高级配置面板，实时修改并应用参数

### 场景 5: 实时状态监控
- **触发**: 代理服务运行中，用户需要查看当前配置和运行状态
- **结果**: 页面显示当前所有配置项的值、运行状态指示器、活跃连接数等

## 4. 关键需求点

**必须有 (P0)**:
- [ ] 代理服务启动/停止控制
- [ ] 端口和绑定地址配置
- [ ] 实时状态显示（运行状态、端口、URL、活跃账号数）
- [ ] 模型映射配置界面（添加、编辑、删除映射规则）
- [ ] 粘性会话配置（开关、TTL、模式）
- [ ] 基本高级设置（超时时间、日志开关、自动启动）

**应该有 (P1)**:
- [ ] 回退链配置（多模型按优先级回退）
- [ ] Token 管理器配置
- [ ] 上游代理配置
- [ ] ZAI 集成配置
- [ ] 实验性功能开关（thinking tokens 等）
- [ ] 配置导入/导出功能
- [ ] 代理 URL 一键复制功能

**可以有 (P2)**:
- [ ] 实时日志预览
- [ ] 配置历史版本管理
- [ ] 配置模板快速应用

## 5. 明确不做

- **不做桌面端特有功能**：托盘菜单、桌面通知等桌面端特有交互
- **不做全局快捷键**：Web 环境不支持
- **不做离线缓存**：首个版本不考虑 PWA 或离线功能
- **不做多用户协同编辑**：配置更新以最后保存为准，不做冲突检测

## 6. 关键风险

- **风险1：API 缺失** → Web Admin 后端需新增完整的代理配置 CRUD API
  - **缓解措施**：前期完成 API 设计评审，确保覆盖所有配置项

- **风险2：组件复用困难** → 桌面端组件依赖 Tauri API，无法直接复用
  - **缓解措施**：抽象数据层接口，UI 组件尽量复用样式和结构

- **风险3：实时状态同步** → Web 端需要通过 WebSocket 或轮询获取状态
  - **缓解措施**：复用现有 WebSocket 连接，添加代理状态推送

## 7. 技术约束

- **前端技术栈**：React + TypeScript（与桌面端一致）
- **UI 组件库**：复用 lucide-react 图标，DaisyUI 样式组件
- **状态管理**：Zustand（与 Web Admin 现有方案一致）
- **API 通信**：REST API + WebSocket（状态推送）
- **样式风格**：适配 Web Admin 的深色主题

## 8. 下一步

✅ **确认 Brief 后，查看完整 Requirements**:
`docs/dev/web-admin-proxy/web-admin-proxy-requirements.md`

✅ **在新会话中执行**:
```bash
/dev:spec-dev web-admin-proxy --skip-requirements
```

这将基于 requirements.md 进行：
1. 技术设计（前后端 API 设计、组件架构）
2. 任务拆分（前端 UI、后端 API、测试）
3. TDD 实施（分阶段开发）
